{% extends 'base.html' %}
{% block title %}ุฅุฏุงุฑุฉ ุงูููุธููู{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- ุงูุนููุงู ุงูุฑุฆูุณู -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-primary mb-0">
            <i class="fas fa-users-cog me-2"></i>ุฅุฏุงุฑุฉ ุงูููุธููู
        </h1>
        <a href="{{ url_for('main.home') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-right me-1"></i> ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
        </a>
    </div>

    <!-- ุจุทุงูุฉ ุงููููุฐุฌ -->
    <div class="card shadow-lg border-0">
        <div class="card-header bg-gradient-primary text-white py-3">
            <h4 class="mb-0">
                <i class="fas fa-user-edit me-2"></i>
                {% if employee_data %}ุชุนุฏูู ุจูุงูุงุช ุงูููุธู{% else %}ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ{% endif %}
            </h4>
        </div>
        <div class="card-body p-4">
            <form id="employeeForm" method="POST" action="{{ url_for('main.add_edit_employees_all') }}">
                <!-- ูุนูููุงุช ุฃุณุงุณูุฉ -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 text-primary">
                            <i class="fas fa-id-card me-2"></i>ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ
                        </h5>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงูุฑูู ุงููุธููู <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-hashtag"></i></span>
                            <input type="text" id="employee_code" name="employee_code" class="form-control" required
                                   placeholder="ุฃุฏุฎู ุงูุฑูู ุงููุธููู" value="{{ employee_data.employee_code if employee_data }}">
                        </div>
                        <div class="form-text">ุงุถุบุท Enter ุจุนุฏ ุฅุฏุฎุงู ุงูุฑูู ูุฌูุจ ุงูุจูุงูุงุช</div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงูุงุณู ุงููุงูู <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-user"></i></span>
                            <input type="text" name="name" class="form-control" required placeholder="ุงูุงุณู ุงููุงูู ููููุธู"
                                   value="{{ employee_data.name if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงููุธููุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-briefcase"></i></span>
                            <input type="text" name="job_title" class="form-control" placeholder="ุงููุณูู ุงููุธููู"
                                   value="{{ employee_data.job_title if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงููุณู</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-building"></i></span>
                            <input type="text" name="department" class="form-control" placeholder="ุงููุณู ุฃู ุงูุฅุฏุงุฑุฉ"
                                   value="{{ employee_data.department if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ููุน ุงูุฏูุงู</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-clock"></i></span>
                            <select name="work_type_schedule" class="form-select">
                                <option value="">ุงุฎุชุฑ ููุน ุงูุฏูุงู</option>
                                <option value="YCSR-A" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSR-A' }}>YCSR-A - ูุฑุฏูุงุช ูู ุงูุณุจุช ุงูู ุงูุซูุงุซุงุก (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSR-B" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSR-B' }}>YCSR-B - ุงุฏุงุฑู ูู ุงูุงุญุฏ ุงูู ุงูุงุฑุจุนุงุก (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSR-C" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSR-C' }}>YCSR-C - ูุฑุฏูุงุช ูู ุงูุงุซููู ุงูู ุงูุฎููุณ (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSR-D" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSR-D' }}>YCSR-D - ูุฑุฏูุงุช ุงูุงุซููู ูุงูุซูุงุซุงุก ุงุฌุงุฒุฉ (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSR-c" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSR-c' }}>YCSR-c - ูุฑุฏูุงุช ูู ุงูุงุฑุจุนุงุก ุงูู ุงูุณุจุช (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRW1" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRW1' }}>YCSRW1 - ุงุณุจูุน * ุงุณุจูุน (7 ุฃูุงู ุฏูุงูุ 7 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRW2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRW2' }}>YCSRW2 - ุงุณุจูุน * ุงุณุจูุน (7 ุฃูุงู ุฏูุงูุ 7 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRK2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRK2' }}>YCSRK2 - ุงุณุจูุนูู * ุงุณุจูุน (14 ุฃูุงู ุฏูุงูุ 7 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRK1" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRK1' }}>YCSRK1 - ุงุณุจูุนูู * ุงุณุจูุน (14 ุฃูุงู ุฏูุงูุ 7 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRSH1" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRSH1' }}>YCSRSH1 - ูุฑุฏูุงุช ุนุงุฏูุฉ (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="N_PR28H1" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'N_PR28H1' }}>N_PR28H1 - ุดูุฑ *ุดูุฑ (28 ุฃูุงู ุฏูุงูุ 28 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="N_PR28H2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'N_PR28H2' }}>N_PR28H2 - ุดูุฑ *ุดูุฑ (28 ุฃูุงู ุฏูุงูุ 28 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="N_PR28H3" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'N_PR28H3' }}>N_PR28H3 - ุดูุฑ *ุดูุฑ (28 ุฃูุงู ุฏูุงูุ 28 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="N_PR28H4" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'N_PR28H4' }}>N_PR28H4 - ุดูุฑ *ุดูุฑ (28 ุฃูุงู ุฏูุงูุ 28 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="SHIFT2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'SHIFT2' }}>SHIFT2 - (42 ุฃูุงู ุฏูุงูุ 14 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRK3" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRK3' }}>YCSRK3 - 6 ุฃุณุงุจูุน * 3 ุฃุณุงุจูุน (42 ุฃูุงู ุฏูุงูุ 14 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMYS4" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMYS4' }}>NORMYS4 - ุงุฏุงุฑู ูู ุงูุงุญุฏ ุงูู ุงูุฎููุณ (5 ุฃูุงู ุฏูุงูุ 2 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMALY2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMALY2' }}>NORMALY2 - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMALY3" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMALY3' }}>NORMALY3 - (7 ุฃูุงู ุฏูุงูุ 0 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMYS5" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMYS5' }}>NORMYS5 - ุงุฏุงุฑู ูู ุงูุณุจุช ุงูู ุงูุซูุงุซุงุก (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMYS6" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMYS6' }}>NORMYS6 - ุงุฏุงุฑู ูู ุงูุงุซููู ุงูู ุงูุฎููุณ (4 ุฃูุงู ุฏูุงูุ 3 ุฃูุงู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMYS7" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMYS7' }}>NORMYS7 - 6 ุฃุณุงุจูุน * 3 ุฃุณุงุจูุน (42 ุฃูุงู ุฏูุงูุ 21 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="N_YCSRE2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'N_YCSRE2' }}>N_YCSRE2 - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="YCSRE1" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'YCSRE1' }}>YCSRE1 - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="NORMYS2" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'NORMYS2' }}>NORMYS2 - ูุฑุฏูุงุช ุงููุจูุนุงุช (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="ycsrsc" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'ycsrsc' }}>ycsrsc - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="ูุฑุฏูุงุช" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'ูุฑุฏูุงุช' }}>ูุฑุฏูุงุช - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                                <option value="ุบูุฑ ูุญุฏุฏ" {{ 'selected' if employee_data and employee_data.work_type_schedule == 'ุบูุฑ ูุญุฏุฏ' }}>ุบูุฑ ูุญุฏุฏ - (6 ุฃูุงู ุฏูุงูุ 1 ููู ุฅุฌุงุฒุฉ)</option>
                            </select>
                        </div>
                        <div class="form-text">ูุธูุฑ ุชูุงุตูู ุฃูุงู ุงูุฏูุงู ูุงูุฅุฌุงุฒุฉ ุนูุฏ ุงูุงุฎุชูุงุฑ</div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงูุดุฑูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-landmark"></i></span>
                            <input type="text" name="company_name" class="form-control" placeholder="ุงุณู ุงูุดุฑูุฉ"
                                   value="{{ employee_data.company_name if employee_data }}">
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงูุณูู -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 text-primary">
                            <i class="fas fa-home me-2"></i>ูุนูููุงุช ุงูุณูู
                        </h5>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ูููุน ุณูู ุงูููุธู</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-map-marker-alt"></i></span>
                            <input type="text" name="employee_housing_location" class="form-control" placeholder="ูููุน ุงูุณูู"
                                   value="{{ employee_data.employee_housing_location if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ููุน ุงูุฎุฏูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-concierge-bell"></i></span>
                            <select name="service_type" class="form-select">
                                <option value="">ุงุฎุชุฑ ููุน ุงูุฎุฏูุฉ</option>
                                <option value="ุณูู" {{ 'selected' if employee_data and employee_data.service_type == 'ุณูู' }}>ุณูู</option>
                                <option value="ููู" {{ 'selected' if employee_data and employee_data.service_type == 'ููู' }}>ููู</option>
                                <option value="ุฃุฎุฑู" {{ 'selected' if employee_data and employee_data.service_type == 'ุฃุฎุฑู' }}>ุฃุฎุฑู</option>
                                <option value="ููู-ุณูู" {{ 'selected' if employee_data and employee_data.service_type == 'ููู-ุณูู' }}>ููู-ุณูู</option>
                                <option value="ููู-ุฎุงุต" {{ 'selected' if employee_data and employee_data.service_type == 'ููู-ุฎุงุต' }}>ููู-ุฎุงุต</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงูุณูู ูู ุงูุดุฑูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-hotel"></i></span>
                            <input type="text" name="company_housing_location" class="form-control" placeholder="ูููุน ุณูู ุงูุดุฑูุฉ"
                                   value="{{ employee_data.company_housing_location if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงุณู ุงูุณูู ูู ุงูุดุฑูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-signature"></i></span>
                            <input type="text" name="company_housing_name" class="form-control" placeholder="ุงุณู ุงูุณูู"
                                   value="{{ employee_data.company_housing_name if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุฑูู ุงูุบุฑูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-door-open"></i></span>
                            <input type="text" name="room_number" class="form-control" placeholder="ุฑูู ุงูุบุฑูุฉ"
                                   value="{{ employee_data.room_number if employee_data }}">
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุฑูู ุงูุณุฑูุฑ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-bed"></i></span>
                            <input type="text" name="bed_number" class="form-control" placeholder="ุฑูู ุงูุณุฑูุฑ"
                                   value="{{ employee_data.bed_number if employee_data }}">
                        </div>
                    </div>
                </div>

                <!-- ุงูุญุงูุฉ ูุงูุฅุนุฏุงุฏุงุช -->
                <div class="row">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 text-primary">
                            <i class="fas fa-cog me-2"></i>ุงูุฅุนุฏุงุฏุงุช
                        </h5>
                    </div>

                    <div class="col-md-6 col-lg-4 mb-3">
                        <label class="form-label fw-bold">ุงูุญุงูุฉ</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="fas fa-user-check"></i></span>
                            <select name="presence_in_company" class="form-select">
                                <option value="1" {{ 'selected' if not employee_data or employee_data.presence_in_company == 1 }}>ูุดุบูู</option>
                                <option value="0" {{ 'selected' if employee_data and employee_data.presence_in_company == 0 }}>ูุงุฑุบ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
                <div class="d-flex gap-3 mt-4 pt-3 border-top">
                    <button type="submit" class="btn btn-primary px-4 py-2">
                        <i class="fas fa-save me-2"></i>ุญูุธ ุงูุจูุงูุงุช
                    </button>
                    <button type="button" id="clearForm" class="btn btn-outline-secondary px-4 py-2">
                        <i class="fas fa-broom me-2"></i>ูุณุญ ุงููููุฐุฌ
                    </button>
                    <button type="button" id="delete_employee" class="btn btn-danger px-4 py-2 ms-auto">
                        <i class="fas fa-trash-alt me-2"></i>ุญุฐู ุงูููุธู
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ุฑุณุงุฆู ุงูุชูุจูู -->
    <div id="alertContainer" class="mt-3"></div>
</div>

<style>
    :root {
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .bg-gradient-primary {
        background: var(--gradient-primary) !important;
    }

    .card {
        border-radius: 15px;
        overflow: hidden;
    }

    .card-header {
        border-bottom: none;
    }

    .form-label {
        margin-bottom: 0.5rem;
    }

    .input-group-text {
        min-width: 45px;
        justify-content: center;
    }

    .form-control, .form-select {
        border-radius: 0.375rem;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        border-color: #667eea;
    }

    .btn {
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--gradient-primary);
        border: none;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .border-bottom {
        border-color: #667eea !important;
    }

    /* ุชุฃุซูุฑุงุช ููุนูุงุตุฑ */
    .input-group {
        transition: transform 0.2s ease;
    }

    .input-group:focus-within {
        transform: translateY(-1px);
    }

    /* ุชุตููู ูุชุฌุงูุจ */
    @media (max-width: 768px) {
        .d-flex.gap-3 {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
    }

    /* ุชุฃุซูุฑ ุงูุชุญููู */
    .loading {
        background-color: #f8f9fa !important;
        opacity: 0.7;
    }
</style>
<style>
    /* ุฅุถุงูุฉ ุฅูู CSS ุงูููุฌูุฏ */
    .border-success {
        border-color: #28a745 !important;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
    }

    .loading {
        position: relative;
    }

    .loading::after {
        content: "ุฌุงุฑู ุงูุชุญููู...";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255,255,255,0.9);
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(document).ready(function(){
    // ุนุฑุถ ุฑุณุงูุฉ ุชูุจูู
    function showAlert(message, type = 'info') {
        const alertClass = {
            'success': 'alert-success',
            'error': 'alert-danger',
            'warning': 'alert-warning',
            'info': 'alert-info'
        }[type] || 'alert-info';

        const alertHtml = `
            <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                <i class="fas fa-${type === 'success' ? 'check-circle' :
                                 type === 'error' ? 'exclamation-triangle' :
                                 type === 'warning' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;

        $('#alertContainer').html(alertHtml);

        // ุฅุฒุงูุฉ ุงูุชูุจูู ุชููุงุฆูุงู ุจุนุฏ 5 ุซูุงูู
        setTimeout(() => {
            $('.alert').alert('close');
        }, 5000);
    }

    // ุฌูุจ ุจูุงูุงุช ุงูููุธู ุนูุฏ ุงูุถุบุท ุนูู Enter
    $('#employee_code').on('keypress', function(e) {
        if (e.which === 13) {
            e.preventDefault();
            let code = $(this).val().trim();

            if(!code) {
                showAlert('ูุฑุฌู ุฅุฏุฎุงู ุงูุฑูู ุงููุธููู ุฃููุงู', 'warning');
                return;
            }

            // ุนุฑุถ ุชุญููู
            $(this).prop('disabled', true).addClass('loading');

            console.log('๐ ุฌูุจ ุจูุงูุงุช ุงูููุธู:', code);

            // ุงุณุชุฎุฏุงู fetch ุจุฏูุงู ูู jQuery ููุชุญูู better
            fetch('{{ url_for("main.get_employee", employee_code="") }}' + encodeURIComponent(code))
                .then(response => {
                    console.log('๐จ ุญุงูุฉ ุงูุงุณุชุฌุงุจุฉ:', response.status);
                    if (!response.ok) {
                        throw new Error('ุฎุทุฃ ูู ุงูุดุจูุฉ');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('๐ ุจูุงูุงุช ุงูุงุณุชุฌุงุจุฉ:', data);

                    if(data && data.success && data.employee){
                        const employee = data.employee;
                        console.log('โ ุชู ุชุญููู ุจูุงูุงุช ุงูููุธู:', employee.name);

                        // ุชุนุจุฆุฉ ุงูุญููู ุจุงูุจูุงูุงุช
                        fillFormWithEmployeeData(employee);
                        showAlert('ุชู ุชุญููู ุจูุงูุงุช ุงูููุธู ุจูุฌุงุญ', 'success');
                    } else {
                        console.log('โ ุงูููุธู ุบูุฑ ููุฌูุฏ:', data);
                        // ูุณุญ ุงููููุฐุฌ ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูุน ุงูุงุญุชูุงุธ ุจุงูุฑูู ุงููุธููู
                        $('#employeeForm')[0].reset();
                        $('input[name="employee_code"]').val(code);
                        showAlert('ุงูููุธู ุบูุฑ ููุฌูุฏุ ุณูุชู ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ ุนูุฏ ุงูุญูุธ', 'info');
                    }
                })
                .catch(error => {
                    console.error('๐ฅ ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช:', error);
                    // ูุณุญ ุงููููุฐุฌ ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูุน ุงูุงุญุชูุงุธ ุจุงูุฑูู ุงููุธููู
                    $('#employeeForm')[0].reset();
                    $('input[name="employee_code"]').val(code);
                    showAlert('ุงูููุธู ุบูุฑ ููุฌูุฏุ ุณูุชู ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ ุนูุฏ ุงูุญูุธ', 'info');
                })
                .finally(() => {
                    $('#employee_code').prop('disabled', false).removeClass('loading');
                });
        }
    });

    // ุฏุงูุฉ ูููุก ุงููููุฐุฌ ุจุจูุงูุงุช ุงูููุธู
    function fillFormWithEmployeeData(employee) {
        console.log('๐ ุชุนุจุฆุฉ ุงููููุฐุฌ ุจุงูุจูุงูุงุช:', employee);

        // ุชุนุจุฆุฉ ุงูุญููู ุงููุตูุฉ
        $('input[name="name"]').val(employee.name || '');
        $('input[name="job_title"]').val(employee.job_title || '');
        $('input[name="department"]').val(employee.department || '');
        $('input[name="company_name"]').val(employee.company_name || '');
        $('input[name="employee_housing_location"]').val(employee.employee_housing_location || '');
        $('input[name="company_housing_location"]').val(employee.company_housing_location || '');
        $('input[name="company_housing_name"]').val(employee.company_housing_name || '');
        $('input[name="room_number"]').val(employee.room_number || '');
        $('input[name="bed_number"]').val(employee.bed_number || '');

        // ุชุนุจุฆุฉ ุงูููุงุฆู ุงูููุณุฏูุฉ
        const workType = employee.work_type_schedule || employee.work_type || '';
        $('select[name="work_type_schedule"]').val(workType);
        console.log('โฐ ููุน ุงูุฏูุงู ุงููุญุฏุฏ:', workType);

        $('select[name="service_type"]').val(employee.service_type || '');
        console.log('๐ ููุน ุงูุฎุฏูุฉ ุงููุญุฏุฏ:', employee.service_type);

        // ูุนุงูุฌุฉ presence_in_company
        let presenceValue = '1';
        if (employee.presence_in_company !== undefined && employee.presence_in_company !== null) {
            presenceValue = employee.presence_in_company.toString();
        }
        $('select[name="presence_in_company"]').val(presenceValue);

        console.log('โ ุชู ุชุนุจุฆุฉ ุงููููุฐุฌ ุจูุฌุงุญ');

        // ุฅุธูุงุฑ ุชุฃููุฏ ุจุตุฑู
        $('input[name="name"]').addClass('border-success');
        setTimeout(() => {
            $('input[name="name"]').removeClass('border-success');
        }, 2000);
    }

    // ูุณุญ ุงููููุฐุฌ
    $('#clearForm').on('click', function(){
        Swal.fire({
            title: 'ูู ุฃูุช ูุชุฃูุฏุ',
            text: 'ุณูุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงููุฏุฎูุฉ',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'ูุนูุ ูุณุญ',
            cancelButtonText: 'ุฅูุบุงุก'
        }).then((result) => {
            if (result.isConfirmed) {
                $('#employeeForm')[0].reset();
                showAlert('ุชู ูุณุญ ุงููููุฐุฌ ุจูุฌุงุญ', 'success');
            }
        });
    });

    // ุญุฐู ุงูููุธู
    $('#delete_employee').on('click', function(){
        let code = $('#employee_code').val().trim();

        if(!code){
            showAlert('ูุฑุฌู ุฅุฏุฎุงู ุงูุฑูู ุงููุธููู ุฃููุงู', 'warning');
            return;
        }

        Swal.fire({
            title: 'ุญุฐู ุงูููุธู',
            text: `ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุธู ุฐู ุงูุฑูู ${code}ุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'ูุนูุ ุงุญุฐู',
            cancelButtonText: 'ุฅูุบุงุก'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '{{ url_for("main.delete_employee", employee_code="") }}' + encodeURIComponent(code),
                    type: 'DELETE',
                    success: function(response){
                        if(response && response.success){
                            Swal.fire('ุชู ุงูุญุฐู!', 'ุชู ุญุฐู ุงูููุธู ุจูุฌุงุญ.', 'success');
                            $('#employeeForm')[0].reset();
                        } else {
                            Swal.fire('ุฎุทุฃ!', (response && response.error) || 'ุงูููุธู ุบูุฑ ููุฌูุฏ ุฃู ุญุฏุซ ุฎุทุฃ.', 'error');
                        }
                    },
                    error: function(xhr){
                        Swal.fire('ุฎุทุฃ!', 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู.', 'error');
                    }
                });
            }
        });
    });

    // ุงูุชุญูู ูู ุงููููุฐุฌ ูุจู ุงูุฅุฑุณุงู
    $('#employeeForm').on('submit', function(e){
        const code = $('#employee_code').val().trim();
        const name = $('input[name="name"]').val().trim();

        if(!code || !name) {
            e.preventDefault();
            showAlert('ูุฑุฌู ููุก ุงูุญููู ุงูุฅูุฒุงููุฉ (ุงูุฑูู ุงููุธููู ูุงูุงุณู)', 'warning');
            return false;
        }

        // ุฅุถุงูุฉ ุชุญููู ููุฅุฑุณุงู
        $('button[type="submit"]').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-2"></i>ุฌุงุฑู ุงูุญูุธ...');
    });

    // ุฅุฐุง ูุงู ููุงู ุจูุงูุงุช ููุธู ูุณุจูุงู (ูู ุญุงูุฉ ุงูุชุนุฏูู)
    {% if employee_data %}
    $(document).ready(function(){
        showAlert('ุชู ุชุญููู ุจูุงูุงุช ุงูููุธู ููุชุญุฑูุฑ', 'info');
    });
    {% endif %}
});
</script>
{% endblock %}